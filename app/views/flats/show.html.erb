
<h2 >Address:  <%= @property.address %>  </h2>
<h3  >City: <%= @property.content %></h3>  
<h4>Property owned by: <%= @property.name %></h4>

<table class = "table table-bordered table-striped">
  
   <tbody>
		
         
        <tr>
        	<th>Flat Nr.</th>
           	<td><%= @flat.flat_nr %></td>
        </tr>
        <tr>
		    <th>Owner</th>
			<td><%= @flat.name %></td>
		</tr>
		<tr>
		    <th>Phone</th>
			<td><%= @flat.phone %></td>
		</tr>
		<tr>
		    <th>Email</th>
			<td><%= @flat.email %></td>
		</tr>
		<tr>
		    <th>Rooms</th>
			<td><%= @flat.rooms %></td>
		</tr>
		<tr>
		    <th>Move in date</th>
			<td><%= @flat.join_date.try(:strftime, "%d-%m-%Y") %>
		</tr>
		<tr>
		    <th>Relatives</th>
			<td><%= @flat.relatives %></td>
		</tr>
		<tr>
		    <th>Caretaker</th>
			<td><%= @flat.caretaker %></td>
		</tr>
		<tr>
		    <th>More Persons</th>
			<td><%= @flat.morepersons %></td>
		</tr>
		<tr>
			<th>Description</th>
			<td><%= @flat.content %></td>
		</tr>
		
  </tbody>
  </table>
  <% if can? :update, @flat%>
		<%= link_to 'Edit', edit_property_flat_path, class: "btn btn-warning"  %> 
	<% end %>
	<% if can? :update, @flat%>
		<%= link_to 'Delete', property_flat_path, method: :delete, class: "btn btn-danger", data: {confirm: "Are you sure?"} %> 
	<% end %>
	
<br />
<br />
<h2>Last owner history</h2>


  <br />

  <table class = "table table-bordered table-striped">
    <thead>
      <tr>   
         <th>Name</th>
         <th>Email</th>
         <th>Move in Date</th>
         <th>Move out Date</th>               
         <th>Delete</th>               
      </tr>
    </thead>
    <tbody>
      <% @flat.ownerhistories.each do |ownerhistory| %>             
        <tr>
          <td><%= ownerhistory.name %></td>
          <td><%= ownerhistory.email %></td>
          <td><%= ownerhistory.move_in_date.try(:strftime, "%d-%m-%Y") %></td>
          <td><%= ownerhistory.move_out_date.try(:strftime, "%d-%m-%Y") %></td>
          <td>
            <%= link_to 'Delete', property_flat_ownerhistory_path(@property,ownerhistory.flat_id, ownerhistory), method: :delete, class: "btn btn-danger", data: {confirm: "Are you sure?"} %>
          </td>   
        </tr>      
      <% end %>
    </tbody>  
  </table>
<br />
<%= form_for ([@property, @flat, @flat.ownerhistories.build()]) do |f| %>
	<table class = "table table-bordered table-striped">
	    <thead>
	      <tr>   
	         <th>Name</th>
	         <th>Email</th>
	         <th>Move in date</th>    
	         <th>Move out date</th>  
	      </tr>
	    </thead>
	    <tbody>  

	        <tr>
	         
		          <td><%= f.text_field :name ,required: true, :value => @flat.try(:name) %></td>
		          <td><%= f.email_field :email ,required: true, :value => @flat.try(:email) %></td>
		          <td><%= f.date_field :move_in_date ,required: true, :value => @flat.try(:join_date).try(:strftime, "%d-%m-%Y") %></td>
		          <td><%= f.date_field :move_out_date, required: true, :value => Date.today.try(:strftime, "%d-%m-%Y") %></td>  

	        </tr>  
	              
	    </tbody>  
	</table>
	<%= submit_tag "Save Current Owner",class: "btn btn-info",data: {confirm: "Are you sure?"} %>    
<% end %> 

<br />
<div class="row" style="background-color:#F0F0F0">
	<div class="col-md-12 col-lg-12" style="text-align:center">
		<h3>Anything broken or you have a complain?</h3>
		<h4>Contact our support!</h4>
		<% if can? :update, Ticket %>
	      <%= link_to 'Submit ticket',new_property_flat_ticket_path(@flat.property_id, @flat),class: "btn btn-info", style: "margin-bottom:2%" %>
	    <% end %>
    </div>
</div>
 <br />
   <table class = "table table-bordered table-striped">
    <thead>
      <tr>   
         <th>Problem</th>
         <th>Name</th>
         <th>Surname</th>
         <th>Date of Fix</th>               
         <th>Delete</th>               
      </tr>
    </thead>
    <tbody>
      <% @flat.mainhistories.each do |mainhistory| %>             
        <tr>
          <td><%= mainhistory.problem %></td>
          <td><%= mainhistory.name %></td>
          <td><%= mainhistory.surname %></td>
          <td><%= mainhistory.fix_date.try(:strftime, "%d/%m/%Y") %></td>
          <td>
            <%= link_to 'Edit', edit_property_flat_mainhistory_path(@property,@flat,mainhistory), class: "btn btn-warning" %>
          </td>   
        </tr>      
      <% end %>
    </tbody>  
  </table>
   <% if can? :create, Flat %>
      <%= link_to 'Add New fix', new_property_flat_mainhistory_path(@property,@flat),class: "btn btn-info" %>
    <% end %> 
<br />

<h3><%= link_to 'Back', property_path(@flat.property_id) %></h3>